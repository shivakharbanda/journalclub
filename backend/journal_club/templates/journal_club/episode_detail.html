{% extends "base.html" %}

{% load markdownify %}
{% block title %}{{ episode.title }} - JournalClub{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="mb-4">
                <h2>{{ episode.title }}</h2>
                <p class="text-muted">{{ episode.created_at|date:"F j, Y" }}</p>
            </div>

            {% if episode.audio_file %}
                <div class="mb-4">
                    <!-- FIXED AUDIO PLAYER - BUG FIXED -->
                    <audio id="episode-audio" controls preload="metadata" style="width: 100%;">
                        <source src="{{ episode.audio_file.url }}" type="audio/wav">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            {% endif %}

            <div class="mb-4">
                <h5>Summary</h5>
                <div class="markdown-content">
                    {{ episode.summary_text|markdownify }}
                </div>
            </div>
            
            {% if episode.sources %}
                <div class="mb-4">
                    <h5>Sources</h5>
                    <ul>
                        {% for link in episode.sources %}
                            <li><a href="{{ link }}" target="_blank" rel="noopener noreferrer">{{ link }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- This is the correct way to initialize audio controls - fixes the seeking issue -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    var audioElement = document.getElementById('episode-audio');
    
    if (audioElement) {
        // Ensure audio is properly loaded so seeking works
        audioElement.addEventListener('loadedmetadata', function() {
            console.log('Audio metadata loaded - seeking will now work');
        });
        
        // Original logging functionality
        audioElement.addEventListener('play', function() {
            console.log("Now playing:", this.querySelector('source').src);
        });
    }
});
</script>
{% endblock %}